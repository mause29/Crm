{
  "openapi": "3.0.3",
  "info": {
    "title": "CRM Completo con PayPal y ML",
    "description": "# Sistema Completo de CRM con Gamificaci칩n\n\nUn sistema avanzado de gesti칩n de relaciones con clientes que incluye:\n\n## 游 Caracter칤sticas Principales\n\n### Gesti칩n de Clientes y Ventas\n- **Clientes**: Gesti칩n completa de base de datos de clientes\n- **Oportunidades**: Seguimiento de oportunidades de venta\n- **Facturas**: Generaci칩n y gesti칩n de facturas con PayPal\n\n### Gamificaci칩n y Motivaci칩n\n- **Logros**: Sistema de badges y puntos para motivar a los usuarios\n- **Notificaciones**: Alertas en tiempo real v칤a Socket.IO\n- **Dashboard**: M칠tricas y reportes visuales\n\n### Seguridad y Autenticaci칩n\n- **JWT**: Autenticaci칩n segura con tokens\n- **2FA**: Autenticaci칩n de dos factores opcional\n- **Roles**: Control de acceso basado en roles (user, manager, admin)\n\n### Integraciones\n- **PayPal**: Procesamiento de pagos\n- **Email**: Automatizaci칩n de correos\n- **Analytics**: An치lisis de datos y machine learning b치sico\n\n## 游닄 Documentaci칩n de la API\n\nEsta API est치 documentada usando OpenAPI 3.0.\n\n### Autenticaci칩n\nLa mayor칤a de los endpoints requieren autenticaci칩n JWT. Incluye el token en el header:\n```\nAuthorization: Bearer <tu_token>\n```\n\n### Ejemplos de Uso\nConsulta los ejemplos en cada endpoint para entender c칩mo usar la API.",
    "version": "1.0.0",
    "contact": {
      "name": "CRM Support",
      "email": "support@crm.com"
    },
    "license": {
      "name": "MIT"
    }
  },
  "servers": [
    {
      "url": "http://localhost:8000",
      "description": "Development server"
    },
    {
      "url": "https://api.crm.com",
      "description": "Production server"
    }
  ],
  "security": [
    {
      "bearerAuth": []
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "schemas": {
      "UserCreate": {
        "type": "object",
        "required": ["name", "email", "password"],
        "properties": {
          "name": {
            "type": "string",
            "minLength": 2,
            "maxLength": 100,
            "description": "Nombre completo del usuario",
            "example": "Juan P칠rez"
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "Correo electr칩nico 칰nico del usuario",
            "example": "juan.perez@empresa.com"
          },
          "password": {
            "type": "string",
            "minLength": 8,
            "maxLength": 128,
            "description": "Contrase침a segura (m칤nimo 8 caracteres, con may칰sculas, min칰sculas y d칤gitos)",
            "example": "SecurePass123"
          },
          "role": {
            "type": "string",
            "enum": ["user", "admin", "manager"],
            "default": "user",
            "description": "Rol del usuario en el sistema",
            "example": "user"
          },
          "company_id": {
            "type": "integer",
            "description": "ID de la compa침칤a (opcional para usuarios independientes)",
            "example": 1
          }
        }
      },
      "ClientCreate": {
        "type": "object",
        "required": ["name", "email", "phone"],
        "properties": {
          "name": {
            "type": "string",
            "minLength": 2,
            "maxLength": 100,
            "description": "Nombre completo del cliente",
            "example": "Mar칤a Garc칤a"
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "Correo electr칩nico del cliente",
            "example": "maria.garcia@cliente.com"
          },
          "phone": {
            "type": "string",
            "pattern": "^\\+?[\\d\\s\\-\\(\\)\\[\\]]+$",
            "description": "N칰mero de tel칠fono del cliente",
            "example": "+34 612 345 678"
          }
        }
      },
      "OpportunityCreate": {
        "type": "object",
        "required": ["name", "value", "client_id"],
        "properties": {
          "name": {
            "type": "string",
            "minLength": 2,
            "maxLength": 200,
            "description": "Nombre descriptivo de la oportunidad",
            "example": "Proyecto Desarrollo Web"
          },
          "value": {
            "type": "number",
            "minimum": 0,
            "description": "Valor monetario de la oportunidad",
            "example": 15000.50
          },
          "client_id": {
            "type": "integer",
            "minimum": 1,
            "description": "ID del cliente asociado",
            "example": 1
          }
        }
      },
      "InvoiceCreate": {
        "type": "object",
        "required": ["client_id", "amount"],
        "properties": {
          "client_id": {
            "type": "integer",
            "minimum": 1,
            "description": "ID del cliente facturado",
            "example": 1
          },
          "amount": {
            "type": "number",
            "minimum": 0,
            "description": "Monto total de la factura",
            "example": 2500.75
          },
          "due_date": {
            "type": "string",
            "format": "date",
            "description": "Fecha de vencimiento (formato YYYY-MM-DD)",
            "example": "2024-12-31"
          }
        }
      }
    }
  },
  "paths": {
    "/users/": {
      "post": {
        "summary": "Crear nuevo usuario",
        "description": "Crea una nueva cuenta de usuario en el sistema.\n\n**Validaciones realizadas:**\n- Email 칰nico en el sistema\n- Contrase침a segura (8+ caracteres, may칰sculas, min칰sculas, d칤gitos)\n- Rol v치lido (user, admin, manager)\n\n**Permisos:** P칰blico (no requiere autenticaci칩n)\n\n**Respuesta exitosa:**\n- C칩digo 200: Usuario creado exitosamente\n- Retorna ID del usuario creado\n\n**Posibles errores:**\n- 400: Email ya registrado o datos inv치lidos\n- 500: Error interno del servidor",
        "tags": ["users"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UserCreate"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Usuario creado exitosamente",
            "content": {
              "application/json": {
                "example": {
                  "msg": "User created successfully",
                  "user_id": 1
                }
              }
            }
          },
          "400": {
            "description": "Datos inv치lidos o email ya registrado",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Email already registered"
                }
              }
            }
          }
        }
      }
    },
    "/users/token": {
      "post": {
        "summary": "Iniciar sesi칩n",
        "description": "Autentica al usuario y retorna un token de acceso JWT",
        "tags": ["users"],
        "requestBody": {
          "required": true,
          "content": {
            "application/x-www-form-urlencoded": {
              "schema": {
                "type": "object",
                "required": ["username", "password"],
                "properties": {
                  "username": {
                    "type": "string",
                    "format": "email",
                    "description": "Correo electr칩nico del usuario",
                    "example": "juan.perez@empresa.com"
                  },
                  "password": {
                    "type": "string",
                    "description": "Contrase침a del usuario",
                    "example": "SecurePass123"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Inicio de sesi칩n exitoso",
            "content": {
              "application/json": {
                "example": {
                  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
                  "token_type": "bearer"
                }
              }
            }
          },
          "401": {
            "description": "Credenciales inv치lidas",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Invalid email or password"
                }
              }
            }
          }
        }
      }
    },
    "/clients/": {
      "get": {
        "summary": "Obtener lista de clientes",
        "description": "Recupera la lista completa de clientes asociados a la compa침칤a del usuario autenticado.\n\n**Caracter칤sticas:**\n- Solo muestra clientes de la misma compa침칤a\n- Requiere autenticaci칩n JWT\n- Ordena por fecha de creaci칩n (m치s recientes primero)\n\n**Permisos:** Usuario autenticado\n\n**Respuesta exitosa:**\n- C칩digo 200: Lista de clientes devuelta exitosamente\n- Retorna array de objetos cliente con informaci칩n b치sica\n\n**Posibles errores:**\n- 401: No autorizado (token inv치lido o faltante)\n- 500: Error interno del servidor",
        "tags": ["clients"],
        "security": [{"bearerAuth": []}],
        "responses": {
          "200": {
            "description": "Lista de clientes obtenida exitosamente",
            "content": {
              "application/json": {
                "example": [
                  {
                    "id": 1,
                    "name": "Mar칤a Garc칤a",
                    "email": "maria.garcia@cliente.com",
                    "phone": "+34 612 345 678",
                    "created_at": "2024-01-15T10:30:00Z"
                  },
                  {
                    "id": 2,
                    "name": "Carlos Rodr칤guez",
                    "email": "carlos.rodriguez@empresa.com",
                    "phone": "+34 698 765 432",
                    "created_at": "2024-01-10T14:20:00Z"
                  }
                ]
              }
            }
          },
          "401": {
            "description": "No autorizado",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Not authenticated"
                }
              }
            }
          }
        }
      },
      "post": {
        "summary": "Crear nuevo cliente",
        "description": "Crea un nuevo cliente asociado a la compa침칤a del usuario autenticado.\n\n**Validaciones:**\n- Email 칰nico en la base de datos\n- Requiere autenticaci칩n JWT\n\n**Permisos:** Usuario autenticado\n\n**Respuesta exitosa:**\n- C칩digo 200: Cliente creado exitosamente\n- Retorna ID del cliente creado\n\n**Posibles errores:**\n- 400: Email ya registrado o datos inv치lidos\n- 500: Error interno del servidor",
        "tags": ["clients"],
        "security": [{"bearerAuth": []}],
        "requestBody": {
          "required": true,
          "content": {
            "application/x-www-form-urlencoded": {
              "schema": {
                "type": "object",
                "required": ["name", "email", "phone"],
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Nombre del cliente",
                    "example": "Mar칤a Garc칤a"
                  },
                  "email": {
                    "type": "string",
                    "format": "email",
                    "description": "Email del cliente",
                    "example": "maria.garcia@cliente.com"
                  },
                  "phone": {
                    "type": "string",
                    "description": "Tel칠fono del cliente",
                    "example": "+34 612 345 678"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Cliente creado exitosamente",
            "content": {
              "application/json": {
                "example": {
                  "msg": "Client created",
                  "client_id": 1
                }
              }
            }
          },
          "400": {
            "description": "Datos inv치lidos o email ya registrado",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Client with this email already exists"
                }
              }
            }
          }
        }
      }
    },
    "/opportunities/": {
      "get": {
        "summary": "Obtener lista de oportunidades",
        "description": "Recupera la lista completa de oportunidades de venta.\n\n**Caracter칤sticas:**\n- Muestra todas las oportunidades disponibles\n- Requiere autenticaci칩n JWT\n- Incluye informaci칩n detallada de cada oportunidad\n\n**Permisos:** Usuario autenticado\n\n**Respuesta exitosa:**\n- C칩digo 200: Lista de oportunidades devuelta exitosamente\n- Retorna array de objetos oportunidad\n\n**Posibles errores:**\n- 401: No autorizado (token inv치lido o faltante)\n- 500: Error interno del servidor",
        "tags": ["opportunities"],
        "security": [{"bearerAuth": []}],
        "responses": {
          "200": {
            "description": "Lista de oportunidades obtenida exitosamente",
            "content": {
              "application/json": {
                "example": [
                  {
                    "id": 1,
                    "name": "Proyecto Desarrollo Web",
                    "value": 15000.50,
                    "client_id": 1,
                    "created_at": "2024-01-15T10:30:00Z",
                    "status": "active"
                  },
                  {
                    "id": 2,
                    "name": "Consultor칤a Digital",
                    "value": 8500.00,
                    "client_id": 2,
                    "created_at": "2024-01-10T14:20:00Z",
                    "status": "active"
                  }
                ]
              }
            }
          },
          "401": {
            "description": "No autorizado",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Not authenticated"
                }
              }
            }
          }
        }
      },
      "post": {
        "summary": "Crear nueva oportunidad",
        "description": "Crea una nueva oportunidad de venta asociada a un cliente existente.\n\n**Validaciones realizadas:**\n- Cliente debe existir en la base de datos\n- Valor debe ser mayor a cero\n- Requiere autenticaci칩n JWT\n\n**Permisos:** Usuario autenticado\n\n**Respuesta exitosa:**\n- C칩digo 200: Oportunidad creada exitosamente\n- Retorna mensaje de confirmaci칩n\n\n**Posibles errores:**\n- 400: Datos inv치lidos o cliente no encontrado\n- 401: No autorizado (token inv치lido o faltante)\n- 500: Error interno del servidor",
        "tags": ["opportunities"],
        "security": [{"bearerAuth": []}],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/OpportunityCreate"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Oportunidad creada exitosamente",
            "content": {
              "application/json": {
                "example": {
                  "msg": "Opportunity created"
                }
              }
            }
          },
          "400": {
            "description": "Datos inv치lidos o cliente no encontrado",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Client not found"
                }
              }
            }
          }
        }
      }
    },
    "/invoices/": {
      "post": {
        "summary": "Crear nueva factura",
        "description": "Crea una nueva factura asociada a un cliente existente.\n\n**Validaciones realizadas:**\n- Cliente debe existir en la base de datos\n- Monto debe ser mayor a cero\n- Requiere autenticaci칩n JWT\n\n**Permisos:** Usuario autenticado\n\n**Respuesta exitosa:**\n- C칩digo 200: Factura creada exitosamente\n- Retorna mensaje de confirmaci칩n\n\n**Posibles errores:**\n- 400: Datos inv치lidos o cliente no encontrado\n- 401: No autorizado (token inv치lido o faltante)\n- 500: Error interno del servidor",
        "tags": ["invoices"],
        "security": [{"bearerAuth": []}],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/InvoiceCreate"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Factura creada exitosamente",
            "content": {
              "application/json": {
                "example": {
                  "msg": "Invoice created"
                }
              }
            }
          },
          "400": {
            "description": "Datos inv치lidos o cliente no encontrado",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Client not found"
                }
              }
            }
          }
        }
      }
    },
    "/invoices/pay/{invoice_id}": {
      "post": {
        "summary": "Procesar pago de factura",
        "description": "Procesa el pago de una factura existente utilizando PayPal.\n\n**Caracter칤sticas:**\n- Utiliza integraci칩n directa con PayPal\n- Procesa pagos con tarjeta de cr칠dito sin login\n- Actualiza el estado de la factura a \"paid\" tras pago exitoso\n- Requiere autenticaci칩n JWT\n\n**Permisos:** Usuario autenticado\n\n**Respuesta exitosa:**\n- C칩digo 200: Pago procesado exitosamente\n- Retorna mensaje de confirmaci칩n\n\n**Posibles errores:**\n- 400: Error en el procesamiento del pago\n- 401: No autorizado (token inv치lido o faltante)\n- 404: Factura no encontrada\n- 500: Error interno del servidor",
        "tags": ["invoices"],
        "security": [{"bearerAuth": []}],
        "parameters": [
          {
            "name": "invoice_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "minimum": 1
            },
            "description": "ID de la factura a pagar",
            "example": 1
          }
        ],
        "responses": {
          "200": {
            "description": "Pago procesado exitosamente",
            "content": {
              "application/json": {
                "example": {
                  "msg": "Invoice paid"
                }
              }
            }
          },
          "400": {
            "description": "Error en el procesamiento del pago",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Payment error"
                }
              }
            }
          },
          "404": {
            "description": "Factura no encontrada",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Invoice not found"
                }
              }
            }
          }
        }
      }
    },
    "/health": {
      "get": {
        "summary": "Verificaci칩n de salud del sistema",
        "description": "Endpoint de verificaci칩n de salud del sistema.\n\n**Respuesta:**\n- status: Estado del sistema\n- timestamp: Timestamp de la verificaci칩n\n- version: Versi칩n de la API",
        "tags": ["health"],
        "responses": {
          "200": {
            "description": "Sistema funcionando correctamente",
            "content": {
              "application/json": {
                "example": {
                  "status": "healthy",
                  "timestamp": "2024-01-15T10:30:00.000Z",
                  "version": "1.0.0",
                  "performance": {
                    "cpu_percent": 15.2,
                    "memory_percent": 45.8,
                    "disk_usage": 234567890
                  }
                }
              }
            }
          }
        }
      }
    },
    "/performance/stats": {
      "get": {
        "summary": "Estad칤sticas de rendimiento",
        "description": "Obtiene estad칤sticas de rendimiento del sistema.\n\n**Permisos:** Solo administradores\n\n**Respuesta:**\n- system: Estad칤sticas del sistema (CPU, memoria, disco)\n- endpoints: Estad칤sticas de rendimiento por endpoint",
        "tags": ["performance"],
        "security": [{"bearerAuth": []}],
        "responses": {
          "200": {
            "description": "Estad칤sticas obtenidas exitosamente",
            "content": {
              "application/json": {
                "example": {
                  "system": {
                    "cpu_percent": 15.2,
                    "memory_percent": 45.8,
                    "disk_usage": 234567890
                  },
                  "endpoints": {
                    "/users/": {
                      "avg_response_time": 0.234,
                      "total_requests": 1250,
                      "error_rate": 0.02
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "tags": [
    {
      "name": "users",
      "description": "Operaciones relacionadas con usuarios y autenticaci칩n"
    },
    {
      "name": "clients",
      "description": "Gesti칩n de clientes"
    },
    {
      "name": "opportunities",
      "description": "Gesti칩n de oportunidades de venta"
    },
    {
      "name": "invoices",
      "description": "Gesti칩n de facturas y pagos"
    },
    {
      "name": "health",
      "description": "Verificaci칩n de estado del sistema"
    },
    {
      "name": "performance",
      "description": "Monitoreo y estad칤sticas de rendimiento"
    }
  ]
}
